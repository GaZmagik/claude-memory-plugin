---
type: breadcrumb
title: "Think: Feature review findings verification and fix planning"
topic: Feature review findings verification and fix planning
status: concluded
created: "2026-01-13T21:40:13.351Z"
updated: "2026-01-13T21:52:14.196Z"
tags:
  - think
  - concluded
scope: project
conclusion: The --call flag bug was caused by passing the flag value ('claude') as the model name instead of using a separate --model flag. Fix applied to think.ts:161,173 - now uses getFlagString(args.flags, 'model') which defaults to 'haiku' in the invoker. Verified working.
promotedTo: gotcha-feature-review-findings-verification-and-fix-plann
---

# Feature review findings verification and fix planning

_Thinking document created 2026-01-13T21:40:13.351Z_

## Thoughts

### 2026-01-13T21:40:24.948Z - Thought
## Context

Seven expert agents completed a comprehensive pre-shipping review of feature/001-memory-plugin (127 commits). Review report saved to .specify/specs/feature/001-memory-plugin/review-report-20260113T213500Z.md.

## Key Findings Summary

### Critical Issues (5 total)
1. **Performance**: Hook injection 125-250ms vs <50ms target (5x over)
2. **Performance**: Semantic search fallback blocks 5-25 seconds
3. **Performance**: execFileSync blocks event loop for up to 2 minutes
4. **Documentation**: Command help lists invalid memory types (context, temporary)
5. **TypeScript**: Type mismatch passing 'ollama' string instead of EmbeddingProvider

### Assessment
- Overall: SHIP WITH CAVEATS
- Security: No critical vulnerabilities
- Test Coverage: 100% effective coverage
- Estimated fix time: 8-10 hours for critical issues

## Verification Strategy

Before implementing fixes, I'll consult with specialist Claude agents to:
1. Verify performance findings are accurate
2. Validate proposed fixes won't introduce new issues
3. Get implementation guidance from domain experts
4. Build consensus on priority and approach

### 2026-01-13T21:45:35.751Z - Thought
## Agent Consultation Blocked

The `--call claude` feature cannot work from within Claude Code - spawning claude CLI from inside a Claude session is blocked (processes killed with SIGKILL).

**Alternative approach:** Use Task tool with specialist agents to verify findings, then manually add their insights to this thinking document.

### 2026-01-13T21:47:42.507Z - Thought
Testing PATH environment

### 2026-01-13T21:51:15.727Z - Thought
## Bug Found: --call Flag Incorrectly Used as Model Name

**Location**: `skills/memory/src/cli/commands/think.ts:170-172`

**The Bug**:
```typescript
call: callAgent
  ? {
      model: callAgent,  // BUG: passes --call value as model!
```

When user runs `memory think add --call claude 'prompt'`:
1. `callAgent = 'claude'`
2. Passes `model: 'claude'` to invokeAI
3. Claude CLI receives `--model claude`
4. CLI rejects it - 'claude' is not a valid model (haiku/sonnet/opus are valid)
5. Error output is empty so we get 'Unknown error'

**The Fix**:
`--call` should specify the PROVIDER (e.g., 'claude'), not the model.
Model should come from `--model` flag with default 'haiku'.

```typescript
call: callAgent
  ? {
      provider: callAgent,  // 'claude' means use Claude CLI
      model: getFlagString(args.flags, 'model') ?? 'haiku',  // actual model
      outputStyle: style,
      agent,
      resume,
    }
  : undefined,
```

### 2026-01-13T21:52:03.155Z - Thought (claude:haiku [e32bc46c-67e8-4d87-92b3-a851ea37d8e1])
The fix is correct. The code at lines 156-177 now properly handles the `--call` flag by extracting it separately using `getFlagString(args.flags, 'call')` and then checking if it exists before constructing the call configuration object. The `--model` flag is correctly parsed on line 161 and passed to the call object on line 173, not mistakenly used as a model name override.

SUCCESS

### 2026-01-13T21:52:14.196Z - Conclusion
The --call flag bug was caused by passing the flag value ('claude') as the model name instead of using a separate --model flag. Fix applied to think.ts:161,173 - now uses getFlagString(args.flags, 'model') which defaults to 'haiku' in the invoker. Verified working.
